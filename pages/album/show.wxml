<!--topics.wxml-->
<import src="../../templates/topic-list.wxml"/>
<import src="../../templates/homepage-topic-section.wxml"/>
<import src="../../templates/loading.wxml"/>
<import src="../../templates/prompt.wxml"/>
<include src="../../includes/hint.wxml"/>
<import src="../../templates/button-formid.wxml"/>

<view hidden="{{hideAchieveCard}}">
  <view class="modal">
    <view class="achieve-tip-card column">
      <include src="../../includes/achieve.wxml"/>
      <text class="size-14 text-color1 achieve-tip-card-text">看完七日辑所有内容，可获得一个成就 </text>
      <text class="size-14 text-color1 achieve-tip-card-text">在我的页面查看所有成就</text>
      <text class="size-16 text-color2 achieve-tip-button1 achieve-tip-button" bindtap="toggleAchieveCardOK">我知道了</text>
    </view>
    <image src="../../images/paid-group/close.png" class="btn-close" bindtap="toggleAchieveCardOK"></image>
  </view>
  <view class="modal-drop"></view>
</view>

<view hidden="{{hideAchieveTip}}">
  <view class="modal">
    <view class="achieve-tip column">
      <image src="../../images/achieve/achieve@3x.png" class="achieve-tip-image"></image>
      <text class="size-22 pingfang-medium text-color1 achieve-tip-text1"> {{achieveProcess === 0 ? '欢迎开始新的学习' : ''}} {{achieveProcess === 7 ? '获得成就' : ''}} </text>
      <text class="size-14 text-color1 achieve-tip-text2">
      {{achieveProcess === 0 ? '看完七日辑所有内容，可获得一个成就' : ''}}</text>
      <text class="size-14 text-color1 achieve-tip-text2">在我的页面查看所有成就</text>
      <text class="size-16 text-color2 achieve-tip-button1 achieve-tip-button" bindtap="toggleAchieveOK">我知道了</text>
      <text class="size-16 text-color3 achieve-tip-button2 achieve-tip-button" bindtap="toggleAchieveNoMore">不再提示</text>
    </view>
    <image src="../../images/paid-group/close.png" class="btn-close" bindtap="toggleAchieveOK"></image>
  </view>
  <view class="modal-drop"></view>
</view>

<view class="modal-container" hidden="{{qrcodeModalHidden}}">
  <view class="modal column qrcode-view">
    <view class="column qrcode-main-view">
      <text class=" size-22 pingfang-medium text-center model-text1">开启推送</text>
      <text class=" size-14 text-color1 model-text2" >关注微信公众号「七日辑」，{{programStartAt !== 0 ? '获取微信群二维码' : '我们为您推送更新'}}</text>
      <image src="../../images/paid-group/qrcode_qiriji.jpg" class="modal-qrcode-img"></image>
      <text class=" size-12 text-color3 model-text3" >或截图保存，用微信扫描</text>
      <text class="size-16 text-white qrcode-button" bindtap="toggleqrcodeModalHidden">知道了</text>
    </view>
    <image src="../../images/paid-group/close.png" class="btn-close" bindtap="toggleqrcodeModalHidden"></image>
  </view>
  <view class="modal-drop"></view>
</view>

<template is="loading" data="{{loadingStatus}}"></template>

<view class="container" lower-threshold="200" wx:if="{{(didUserPay || trial) && loadingStatus === null}}">
  <view wx:if="{{loadingStatus !== 'LOADING'}}" class="top-view column">
    <text class=" size-26 text-color1 FZRUIZH_CUJW--GB1-0 top-title">{{title}}</text>
  </view>

  <swiper current="{{posts.length - current}}" bindchange="listenSwiper" class="list-container" wx:key="">
    <swiper-item id="id-{{post.id}}" wx:for="{{posts}}" wx:for-item="post" wx:key="" class="{{((post.meta.unlocked && didUserPay) || (posts.length - index === 1)) || (role === 1) ? 'unlocked' : 'locked'}}">

      <text class="size-12 text-color3 FZRUIZH_CUJW--GB1-0 top-tip text-center">{{post.hint}}</text>
      <view class="topic">
        <view class="locker-mask column">
          <view class="row">
            <image src="../../images/paid-group/锁@2x.png" class="lock-img"></image>
            <text class="size-16 text-color3">{{didUserPay ? '还未解锁，一天解锁一课哦' : '本课还未解锁'}}</text>
          </view>
          <text class="size-12 text-white buy-button" bindtap="buy" wx:if="{{trial}}">购买：{{price / 100}}元</text>
        </view>

        <view class="topic-info">
          <view class="medium-banner" style="background-image: url('{{post.attributes.picUrl}}')">
            <view class="medium-banner-mask"></view>
            <text class="size-12 text-white label-trial" wx:if="{{!didUserPay && posts.length - index === 1}}">免费试读</text>
            <image src="../../images/achieve/achieve@2x.png" class="achieve-image"  bindtap="toggleAchieveCardOK" wx:if="{{didUserPay}}"></image>
            <view class="row bottom-view">
              <image src="{{author.attributes.profilePicUrl}}" class="head-img"></image>
              <view class="right-view column top-text" >
                <text class="size-10 ji-zhu-text">辑主</text>
                <text class="size-12 ji-zhu-name">{{author.attributes.username}}</text>
              </view>
            </view>
            <text class=" size-12 text-white top-text">{{post.attributes.title}}</text>
          </view>
        </view>

        <view class="mediums row">
          <view class="medium {{post.relationships.media.data.length > 2 ? 'medium-50' : 'medium-100'}} {{idx === 1 || idx === 2 ? 'medium-gray' : ''}}" wx:for="{{ post.relationships.media.data }}" wx:for-item="medium" wx:for-index="idx"  data-medium="{{ medium}}" data-index="{{index}}" data-idx="{{idx}}" data-count="{{post.relationships.media.data.length}}" wx:key="" bindtap="goToMedium">
            <template is="buttonFormid"></template>
            <text class="medium-type  size-9 text-white" wx:if="{{medium.attributes.mediumType  === 'video' || medium.attributes.mediumType === 'audio'}}">{{medium.attributes.mediumType === 'video' ? '视频' : '音频'}}</text>
            <text class="medium-title  size-16">{{post.relationships.media.data.length === 1 ? '' : (idx + 1) + '. ' }}{{medium.attributes.title }}</text>
          </view>
        </view>

      </view>
    </swiper-item>
  </swiper>
  <view class="count-view row">
    <view>
      <view wx:if="{{subscribersCount >= 5}}" class="row"> <!-- To make sure page indicator always on the right-->
        <image src="{{user.attributes.profilePicUrl}}" wx:for="{{subscribers}}" wx:key="" wx:for-item="user" class="subscriber-profile-image"></image>
        <text class="text-gray size-10 text-subscribers-count">{{subscribersCount}}人与你共同观看</text>
      </view>
    </view>

    <view>
      <text class="size-22 pingfang-medium text-color1">{{current}}</text>
      <text class="size-12 pingfang-medium text-color1">/{{posts.length}}</text>
    </view>
  </view>

  <view class="tip-line">
    <view class="line {{index === (posts.length - current) ? 'line-blue' : 'line-gray'}}" wx:for="{{posts}}" wx:for-item="post"  wx:key=""></view>
  </view>

  <template is="loading" data="{{loadingStatus}}"></template>
</view>

<scroll-view scroll-y style="height: {{screenHeight}}px" scroll-into-view="{{toView}}" wx:if="{{(!didUserPay && !trial) && loadingStatus === null}}" class="buy-page">
  <view class="head-view">
    <!-- paid_group -->
    <image src="{{picurl}}" mode="aspectFill"  class="paid-group-pic"></image>
    <view class="title">
      <text class="title-text  size-26">{{title}}</text>
      <!-- <text class="title-type">零基础</text>-->
    </view>
    <view class="price-view row">
      <text class="price-now  size-20">￥{{(price / 100)}} </text>
      <text class="price-tip price-old  size-12">￥{{originalPrice}} </text>
    </view>
    <view class="line-view"></view>
  </view>

    <view class="content-top row">
      <text class="content-button size-18 pingfang-medium" style="color: {{selectedIndex === 0 ? '#1A1A1A' : '#808080'}}; border-bottom: {{selectedIndex === 0 ? '1px solid #42BD56' : '1px solid #EDEDED'}}" data-type="descroption" bindtap="changeTab">简介</text>
      <text class="content-button size-18 pingfang-medium" style="color: {{selectedIndex === 1 ? '#1A1A1A' : '#808080'}}; border-bottom: {{selectedIndex === 1 ? '1px solid #42BD56' : '1px solid #EDEDED'}}" data-type="category" bindtap="changeTab">目录</text>
    </view>

    <view class="jizhu-view">
      <view class="row">
        <image src="{{editorInfo.profilePicUrl}}" class="jizhu-img"></image>
        <text class="ji-zhu-username  size-20 pingfang-medium text-color1">{{editorInfo.username}}</text>
      </view>
      <text class="ji-zhu-description  size-14 text-color2">{{editorInfo.description || '这是详细介绍' }}</text>
    </view>

    <view class="line-view"></view>

    <view class="lessons-description">
      <text class="lesson-tip size-18 text-color1">课程介绍</text>
      <text class="lessons-description-text size-14 text-color1 column">{{description}}</text>
      <image src="{{descriptionPicUrl}}" class="lessons-description-img" mode="widthFix"></image>
    </view>

    <view class="target-audience">
      <text class="about-qiriji bg-blue size-12">适用人群</text>
      <text class="text-color1 size-14 content-text column">{{targetAudience}}</text>
    </view>

    <view class="target-audience">
      <text class="about-qiriji bg-blue size-12">购买须知</text>
      <text class="text-color1 size-14 content-text column">{{buyNotes}}</text>
    </view>

    <view class="qrcode-view-bottom row">
      <view class="column gz-view">
        <text class="bg-blue size-16 pingfang-medium text-center gz-text">关注七日辑</text>
        <text class=" size-12 text-color2 " >即可在子菜单“已购”中随时观看自己购买的课程，已经获得更多关于课程资料，导师互动等信息</text>
      </view>
      <image src="../../images/paid-group/qrcode_qiriji.jpg" class="qrcode-img-b"></image>
    </view>

    <view class="about-view">
      <text class="about-qiriji bg-blue size-12">关于七日辑</text>
      <text class="about-qiriji-content size-14">《七日辑》让你用7天的碎片时间，实现一个小目标。
      每个专辑都由一位相关领域的资深辑主制作，从 200+优质网站、1000+公众号/专栏中精心 挑选 28 篇文章，最终系统整理成辑。
      </text>

      <view class="about-type row">
        <text class="about-type-left bg-blue size-12">提示自我</text>
        <text class="about-type-right text-color2 size-14">你是否想利用碎片时间
  进行自我提升? </text>
      </view>
      <view class="about-type row">
        <text class="about-type-left bg-blue size-12">为你筛选</text>
        <text class="about-type-right text-color2 size-14">你是否觉得网上内容太多太杂，
  自己筛选过滤太浪费时间? </text>
      </view>
      <view class="about-type row">
        <text class="about-type-left bg-blue size-12">为你挖掘</text>
        <text class="about-type-right text-color2 size-14">你是否想要发掘更多更有趣的公众号/专栏? </text>
      </view>
    </view>
    <view class="line-view"></view>
    <view class="lessons" id="category">
      <text class="lesson-tip pingfang-medium size-18 text-color1">课程目录</text>
      <view class="lesson column" wx:for="{{catalog}}" wx:key="" wx:for-index="index" wx:for-item="catalogItem">
        <view class="day-top row">
          <text class="day-index size-14">D{{index + 1}}</text>
          <text class="day-title size-18">{{catalogItem.title}}</text>
        </view>
        <view class="day-bottom column">
            <text class="day-text size-14 text-color1" wx:for="{{catalogItem.bulletpoints}}" wx:key="" wx:for-item="text">{{text.content}}</text>
        </view>
      </view>
    </view>


  <view class="btns-container row">
    <view class="shidu column" bindtap="gotoTrial">
      <image src="/images/paid-group/试读.jpg" class="shidu-img" mode="aspectFill"></image>
      <text class="shidu-text text-color2 size-12">试读</text>
    </view>
    <view class="free column" bindtap="gotoFree">
      <image src="/images/paid-group/免费@2x.png" class="free-img" mode="aspectFill"></image>
      <text class="free-text text-color2 size-12">免费得</text>
    </view>
    <button bindtap="showPay" class="btn-buy">立刻购买 {{price / 100}}元</button>
  </view>
</scroll-view>
<!-- shareAlert -->
<view class="shareAlert" wx:if="{{shareAlert && !didUserPay && loadingStatus !== 'LOADING'}}">
  <view wx:if="{{shareAlert.alert}}" class="masked">
    <view class="alert">
      <view class="container">
        <text class="title size-22">看来你和{{shareAlert && shareAlert.username}}志同道合</text>
        <text class="text size-16">
        “集齐5人免费看”活动全场适用，快来逛逛吧！</text>
        <button bindtap="showGuide" >立刻参加</button>
        <image class="close-button" src="/images/close-white.png" bindtap="closeAlert" ></image>
      </view>
    </view>
  </view>
  <view wx:if="{{shareAlert.guide}}" class="guide">
    <image mode="widthFix" src="https://ailingual-production.oss-cn-shanghai.aliyuncs.com/pics/%E4%B8%83%E6%97%A5%E8%BE%91/guide.png"></image>
    <button data-type="guide" bindtap="closeAlert">我知道了</button>
  </view>
</view>
<!-- 支付页面 -->
<view class="pay" wx:if="{{payView}}">
  <view bindtap="hidePay" class="mask"></view>
  <view class="pay-container" bindtap="none">
    <view class="size-22">{{title}}</view>
    <!-- <view class="remarks size-12">备注：</view> -->
    <view class="line"></view>
    <text class="text size-16">优惠券</text>
    <view wx:if="{{coupons.length !== 0}}" bindtap="gotoChoiceCoupon" style="float: right;">
      <text wx:if="{{(coupons.length !== 0) && !coupon}}" class="size-12" style="background: #DF0A20;border-radius: 3px;color: #fff;height: 21px;width: 44px;display: inline-block;line-height: 21px;text-align: center;vertical-align: middle;margin-right: 5px;">有卡券</text>
      <text class="size-16">{{couponIndex === -1 ? '还未选择优惠卡券' : coupon.name}}</text>
    </view>
    <view wx:else class="size-16" style="float: right;color: #B0B0B9;">没有可以抵用的优惠券</view>
    <view class="line"></view>
    <text class="text size-16">支付金额</text>
    <text class="size-18" style="float: right;">￥{{(coupon ? ((price - coupon.quota) > 0 ? (price - coupon.quota) : 0) : price) / 100}}</text>
    <view class="line"></view>
    <button bindtap="buy" disabled="{{processing}}" loading="{{processing}}">微信支付</button>
  </view>
</view>

<template is="prompt" data="{{tempAlert}}"></template>
